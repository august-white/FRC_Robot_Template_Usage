# Motor Control
This is a (hopefully) comprehensive guide on how to control motors in FRC. This guide assumes you are using TalonFX or TalonSRX motor variables. All of the code should be inserted into the command file.
## Types of Motor Control

### Voltage (VelocityVoltage)
This control mode will set the motor's velocity setpoint to the velocity specified by the user. In addition, it will apply an additional voltage as an arbitrary feedforward value.

#### The VelocityVoltage Class
```
VelocityVoltage(
    double Velocity, 
    double Acceleration, 
    boolean EnableFOC, 
    double FeedForward, 
    int Slot, 
    boolean OverrideBrakeDurNeutral, 
    boolean LimitForwardMotion, 
    boolean LimitReverseMotion
)
```
#### Parameters:

**Velocity:** Velocity to drive toward in rotations per second.

**Acceleration:** Acceleration to drive toward in rotations per second squared. This is typically used for motion profiles generated by the robot program.

**EnableFOC:** <u>True:</u> use FOC commutation (requires Phoenix Pro), which increases peak power by ~15%. <u>False:</u> use trapezoidal commutation. FOC improves motor performance by leveraging torque (current) control. However, this may be inconvenient for applications that require specifying duty cycle or voltage. CTR-Electronics has developed a hybrid method that combines the performances gains of FOC while still allowing applications to provide duty cycle or voltage demand. This not to be confused with simple sinusoidal control or phase voltage control which lacks the performance gains.

**FeedForward:** Feedforward to apply in volts

**Slot:** Select which gains are applied by selecting the slot. Use the configuration api to set the gain values for the selected slot before enabling this feature. Slot must be within [0,2].

**OverrideBrakeDurNeutral:** Set to true to static-brake the rotor when output is zero (or within deadband). Set to false to use the NeutralMode configuration setting (default). This flag exists to provide the fundamental behavior of this control when output is zero, which is to provide 0V to the motor.

**LimitForwardMotion:** Set to true to force forward limiting. This allows users to use other limit switch sensors connected to robot controller. This also allows use of active sensors that require external power.

**LimitReverseMotion:** Set to true to force reverse limiting. This allows users to use other limit switch sensors connected to robot controller. This also allows use of active sensors that require external power.

### Velocity (VelocityDutyCycle)
This control mode will set the motor's velocity setpoint to the velocity specified by the user. In addition, it will apply an additional voltage as an arbitrary feedforward value.

#### The VelocityDutyCycle Class
```java
VelocityDutyCycle(double Velocity)
```
##### Parameters:

**Velocity:** Velocity to drive toward in rotations per second.

### PercentOutput (DutyCycleOut)
This control mode will output a proportion of the supplied voltage which is supplied by the user.

#### The DutyCycleOut Class
```java
DutyCycleOut(double Output)
```
##### Parameters:
**Output:** Proportion of supply voltage to apply in fractional units between -1 and +1



### Step #1: Declare the variable
Note that all of the parameters declared here are defaults and will be expected to change throughout running the code.
#### Voltage 
```java
private VelocityVoltage exampleVoltage = new VelocityVoltage(0, 0, true, 0, 0, false, false, false);
```
#### Velocity (Duty Cycle)
```java
private VelocityDutyCycle exampleVelocity = new VelocityDutyCycle(0);
```
#### Percent Output
```java
private DutyCycleOut examplePercentOutput = new DutyCycleOut(0);
```

### Step #2: Create the run method
Note that these functions make use of `motor` variables, which should definitely not be called simply `motor`. Similarly, Talons should not simply be called `motorTalon`. Lastly, note that the numbers in these functions are random numbers, and will most likely need to be changed based on the subsystem.
#### Voltage
```java
public void exampleRunVoltage(double velocity) {
    motor.setControl(
        exampleVoltage
        .withVelocity(velocity)
        .withFeedForward(0.5)
    );

    motorTalon.set(
        TalonSRXControlMode.PercentOutput,
        0.5
    );
}
```
#### Velocity (Duty Cycle)
```java
  public void exampleRunVelocity(double velocity) {
    exampleVelocity.Velocity = velocity;
    motor.setControl(exampleVelocity);

    motorTalon.set(
        TalonSRXControlMode.PercentOutput,
        0.5
    ); 
}
```
#### Percent Output
```java
  public void setExampleSpeed(double percentOutput){
    examplePercentOutput.Output = percentOutput;
    motor.setControl(examplePercentOutput);
    motorTalon.set(
        TalonSRXControlMode.PercentOutput,
        0.95
    );
}
```